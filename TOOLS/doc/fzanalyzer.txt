#include "common_options.txt"
#include "fz_analysis.h"
#define N_C
.TH FZANALYZER 1 MANDATE "Generic Mapping Tools 5.4 [GSFML supplement]"
.SH NAME
fzanalyzer \- Analysis of fracture zones using crossing profiles
.SH SYNOPSIS
BD(fzanalyzer) IT(crossprofiles) OPT(F)IT(fzlines) [ OPT(A)IT(min)/IT(max)/IT(inc) ] 
[ OPT(C)IT(min)/IT(max)/IT(inc) ] [ OPT(D)IT(corrwidth) ] [ OPT(I)IT(FZid)[/IT(profile)] ] 
[ OPT(S)[BD(c)] ] [ OPT(T)IT(prefix) ] [ GMT_V_OPT ] [ OPT(W)IT(min)/IT(max)/IT(inc) ] 
[ GMT_colon_OPT ] [ GMT_bi_OPT ] [ GMT_i_OPT ]
.SH DESCRIPTION
BD(fzanalyzer) is a tool developed as part of the Global Seafloor Fabric
and Magnetic Lineation Project [see www.soest.hawaii.edu/PT/GSFML for a full
description of the project].  It reads processed fracture zone (FZ) traces and cross-profiles as
produced by BD(gmt grdtrack).  It then analyzes the trace of each FZ
by examining cross-sections orthogonal to the FZ trend and modeling these profiles
using a blend model of "Atlantic"-style symmetric troughs and "Pacific"-style asymmetric,
dipole-like anomalies, modulated with some peripheral bulges ("compression").
We also fit just the symmetric trough model and
examine the empirical data minimum and trough width.  Estimates are made
of the width of the data trough and 1-sigma uncertainties on the best FZ locations
given by the various models.  We also compute several statistical measures and return
all the model parameters as a function of distances along each FZ.
.TP
IT(crossprofiles)
This file is a table with cross-profiles as produced by BD(gmt grdtrack) OPT(C).
This is an ASCII (or binary, see OPT(bi)) file that must contain 7 data columns:
lon, lat, dist, azimuth, vgg, age, fzdist; it is produced by BD(gmt grdtrack) OPT(C)
from an approximate digitized trace (with IT(lon), IT(lat)) of one or more FZs.
See INPUT FILES for more details.
.TP
OPT(F)IT(fzlines) is a file with resampled track lines obtained by running BD(gmt grdtrack) OPT(D).
As for IT(crossprofiles) the file must contain the same 7 data columns \fIlon, lat, dist, azimuth, vgg, age, fzdist\fP.
See INPUT FILES for more details.
.SH OPTIONS
No space between the option flag and the associated arguments.
.TP
OPT(A)IT(min)/IT(max)/IT(inc)
Specifies one or three parameters that control how the blending of the model signals will be done.
Here, IT(min) is the minimum asymmetry value [DEF_M_MIN, i.e., "Atlantic" symmetric trough],
IT(max) is the maximum asymmetry [DEF_M_MAX, i.e., "Pacific" dipole signal], and IT(inc) is the
increment used for the search [DEF_M_INC].  To specify just a single asymmetry value (no search),
just provide the single desired asymmetry.
.TP
OPT(C)IT(min)/IT(max)/IT(inc)
Specifies one or three parameters that control how the search for the "compression" model signal will be done.
Here, IT(min) is the minimum compression value [DEF_L_MIN],
IT(max) is the maximum compression [DEF_L_MAX, i.e., "Mexican Hat" end-member], and IT(inc) is the increment used for the search [DEF_L_INC].
To specify just a single compression value (no search), just provide the single desired compression value.
.TP
OPT(D)IT(corrwidth)
Specifies a IT(corrwidth) (in km) that sets the width of the central corridor [DEF_D_WIDTH].  The purpose
of this corridor is to constrain how far off center we may seek to relocate the location of the FZ trough.
.TP
OPT(I)IT(FZid)
By default, we will analyze the cross-profiles generated for all FZs.  However,
you can use OPT(I) to specify a particular FZ IT(id) id (first id is 0).
Optionally, you can select that only one profile from that FZ be processed [Default is all].
Note that the output files will still contain all profiles but derived quantities will be
zero except for the chosen profiles.
.TP
OPT(S)[BD(c)]
Output the parameters set by the command-line options in a format suitable for inclusion
in a Bourne/bash shell script.  Alternatively, append BD(c) for csh/tcsh syntax.
.TP
OPT(T)IT(prefix)
Sets the file name prefix used for all output files [fztrack].
#include "explain_-V.txt"
.TP
OPT(W)IT(min)/IT(max)/IT(inc)
Specifies three parameters that control how the modeling of the cross-FZ signal will be done.
Here, IT(min) is the minimum FZ signal width (in km) for a nonlinear width search [1],
IT(max) is the maximum width [50], and IT(inc) is the increment used for the width search [1].
It is recommended to determine suitable limits of a particular region and tune OPT(W) accordingly.
Selecting too wide a range might lead to spurious fits driven by data features not associated with
the FZ trough.
#include "explain_colon.txt"
#include "explain_-bi.txt"
[Default is 7 input columns].
#include "explain_-icols.txt"
#include "explain_help.txt"
#include "explain_precision.txt"
.SH INPUT FILES
The two input files are themselves generated by running BD(gmt grdtrack) first.  This step
requires a set of digitized FZ tracks (lon, lat) and three data grids: (a) a
VGG vertical gravity gradient IMG file, (b) a 2 minute crustal age grid, and (c)
a grid with distance to the nearest FZ in km, listed in that order.  The critical file is the
VGG grid.  If you don't have or care about ages and distances you can make dummy grids that
are all NaNs.  You design your cross-profile layout
and resampled FZ trackes using BD(gmt grdtrack) OPT(C) OPT(D).
.SH NEAREST FRACTURE ZONE DISTANCES
You can use BD(gmt grdmath) to create the nearest fracture zone distance grid (in km) required
to prepare the profiles.  A typical command suitable for the Nazca plate area might be
.br
.sp
gmt grdmath -R-120/-65/-50/5 -I5m -fg digitize.txt LDIST DEG2KM = dist2fz.nc
.br
.sp
Since this is a very slow calculation for numerous FZs it is not necessary to use a very high resolution
in OPT(I) since the distances change smoothly and interpolation will be approximately correct.  Consider
making a global grid but do it in quadrants (or smaller region chunks) and run concurrently on a multi-core
computer. For example, to make a global grid from quadrants, one may run
.br
gmt grdmath -R0/180/0/90 -I2m -fg -V3 global_FZ.txt LDIST DEG2KM = WN.nc
.br
gmt grdmath -R180/360/0/90 -I2m -fg -V3 FZ_KM.txt LDIST DEG2KM = EN.nc
.br
gmt grdmath -R0/180/-90/0 -I2m -fg -V3 FZ_KM.txt LDIST DEG2KM = WS.nc
gmt .br
gmt grdmath -R180/360/-90/0 -I2m -fg -V3 FZ_KM.txt LDIST DEG2KM = ES.nc
.br
.sp
then blend these together into a global grid with
.br
.sp
gmt grdblend -Rg -I2 -fg EN.nc WN.nc ES.nc WS.nc -Gdist2FZ.nc -V
.br
rm -f WN.nc EN.nc WS.nc ES.nc
.br
.sp
To make NaN grids for ages and/or distances for the Nazca area, use
.br
.sp
gmt grdmath -R-120/-65/-50/5 -I5m -fg 0 0 NaN = ages.nc
.SH OUTPUT FILES
BD(gmt fzanalyzer) can produce up to three output files; these are described below:
.br
(1) IT(prefix)_analysis.txt contains the results of the analysis for each cross
profile.  There 61 output columns containing the fitted or observed values (see
DETERMINED PARAMETERS).  This file is used by BD(gmt fzblender) to produce a smooth
and optimal fit to the fracture zone.
.br
(2) IT(prefix)_cross.txt contains both observed and predicted best-fitting models
for each cross profile.  It can be used for plotting and visual analysis of the
results on a profile-by-profile basis.
.br
(3) IT(prefix)_par.[c]sh is either a Bourne (OPT(S)) or cshell (OPT(Sc)) script
that contains all parameters specified by the command line as shell variables. You
can include this script in custom mapping or analysis scripts and use the variables
as you see fit.
(4) Finally, while not an output file form BD(fzanalyzer), you should use the name IT(prefix)_resampled.txt
for the output of BD(gmt grdtrack) OPT(D) as that is what the scripts for plotting expect.
.SH EXAMPLES
To analyze digitized FZs we use the Sandwell/Smith IMG format file vgg.16.1.img (1 minute vertical
gravity gradient on a Mercator grid, with scale 0.02 and mode 1), an age grid (with
crustal ages in units of 0.01 Ma), and a nearest-FZ distance grid (in km). Given the
potential FZ locations in the multi-segment file fz_digitized.txt, we specify a 40 km cross-profile
length, with profiles spaced every 5 km, and use an along-cross-profile sampling
interval of 2 km, by running
.br
.sp
gmt grdtrack fz_digitized.txt -C40k/2k/5k -Gvgg.16.1.img,0.02,1 -Gage.3.2.nc=ns/0.01/0 -Gdist.nc -Dtraces_resampled.txt -fg --FORMAT_GEO_OUT=ddd.xxxx --FORMAT_FLOAT_OUT=%.1f > xprofiles.txt
.br
.sp
These two data tables can now be used with BD(gmt fzanalyzer) to analyze the traces.  Here,
we specify a 20 km central corridor and accept default values for most settings:
.br
.sp
gmt fzanalyzer xprofiles.txt -D20 -Ftraces_resampled.txt -Ttraces -S --FORMAT_GEO_OUT=ddd.xxxx --FORMAT_FLOAT_OUT=%.1f
.br
.sp
You can then make plots of these cross-profiles with best-fitting curves and parameters
indicated by using
.br
.sp
fzprofiler traces -W6i -H2i -N2
.br
.sp
which will plot all cross-profiles in separate 6x2 inch cross-sections stacked in one vertical panel.
You can show this information in map view via
.br
.sp
fzmapper traces -W9i -L1 -Ffz_digitized.txt
.br
.sp
See the BD(fzprofiler) and BD(fzmapper) man pages for further details.
.SH DETERMINED PARAMETERS
Here are the header codes for each of the N_FZ_ANALYSIS_COLS output columns and what they represent:
.br
.sp
BD(XR): Longitude of raw digitized trace.
.br
BD(YR): Latitude of raw digitized trace.
.br
BD(DR): Distance at digitized points along raw digitized trace.
.br
BD(AR): Azimuth at digitized points along raw digitized trace.
.br
BD(ZR): Data value at digitizing locations
.br
BD(TL): Crustal age estimate at left side of FZ (negative distances).
.br
BD(TR): Crustal age estimate at right side of FZ (positive distances).
.br
BD(SD): Shift of data minimum (in km) from raw line origin.
.br
BD(ST): Shift of trough model minimum (in km) from raw line origin.
.br
BD(SB): Shift of blend model minimum (in km) from raw line origin.
.br
BD(SE): Shift of blend model maximum slope (in km) from raw line origin.
.br
BD(BL): Best blend value [0-1].
.br
BD(OR): Orientation of blend model profile (-1 means left side is old, +1 means left side is young).
.br
BD(WD): Width of data trough.
.br
BD(WT): Width of model trough (for trough model).
.br
BD(WB): Width of model trough (for blend model).
.br
BD(AD): Peak-to-trough amplitude from data.
.br
BD(AT): Peak-to-trough amplitude from model (for trough model).
.br
BD(AB): Peak-to-trough amplitude from model (blend).
.br
BD(UT): Compression indicator (for trough model).
.br
BD(UB): Compression indicator (for blend model).
.br
BD(VT): Variance reduction (%) from model (for trough model).
.br
BD(VB): Variance reduction (%) from model (for blend model).
.br
BD(FT): F-statistic (for trough model).
.br
BD(FB): F-statistic (for blend model).
.br
BD(XDL): Longitude of data minimum left bounds.
.br
BD(XD0): Longitude of data minimum.
.br
BD(XDR): Longitude of data minimum right bounds.
.br
BD(YDL): Latitude of data minimum left bounds.
.br
BD(YD0): Latitude of data minimum.
.br
BD(YDR): Latitude of data minimum right bounds.
.br
BD(ZDL): Value of data minimum left bounds.
.br
BD(ZD0): Value of data minimum.
.br
BD(ZDR): Value of data minimum right bounds.
.br
BD(XTL): Longitude of minimum (for trough model) left bounds.
.br
BD(XT0): Longitude of minimum (for trough model).
.br
BD(XTR): Longitude of minimum (for trough model) right bounds.
.br
BD(YTL): Latitude of minimum (for trough model) left bounds.
.br
BD(YT0): Latitude of minimum (for trough model).
.br
BD(YTR): Latitude of minimum (for trough model) right bounds.
.br
BD(ZTL): Model prediction (for trough model) at left bounds.
.br
BD(ZT0): Model prediction minimum (for trough model).
.br
BD(ZTR): Model prediction (for trough model) at right bounds.
.br
BD(XBL): Longitude of minimum (for blend model) left bounds.
.br
BD(XB0): Longitude of minimum (for blend model).
.br
BD(XBR): Longitude of minimum (for blend model) right bounds.
.br
BD(YBL): Latitude of minimum (for blend model) left bounds.
.br
BD(YB0): Latitude of minimum (for blend model).
.br
BD(YBR): Latitude of minimum (for blend model) right bounds.
.br
BD(ZBL): Model prediction (for blend model) at left bounds.
.br
BD(ZB0): Model prediction minimum (for blend model).
.br
BD(ZBR): Model prediction (for blend model) at right bounds.
.br
BD(XEL): Longitude of maximum slope (for blend model) left bounds.
.br
BD(XE0): Longitude of maximum slope (for blend model).
.br
BD(XER): Longitude of maximum slope (for blend model) right bounds.
.br
BD(YEL): Latitude of maximum slope (for blend model) left bounds.
.br
BD(YE0): Latitude of maximum slope (for blend model).
.br
BD(YER): Latitude of maximum slope (for blend model) right bounds.
.br
BD(ZEL): Model prediction at maximum slope (for blend model) at left bounds.
.br
BD(ZE0): Model prediction at maximum slope (for blend model).
.br
BD(ZER): Model prediction at maximum slope (for blend model) at right bounds.
.SH "SEE ALSO"
.IR fzblender (1),
.IR fzinformer (1),
.IR fzmapper (1),
.IR fzmodeler (1),
.IR fzprofiler (1),
.IR gmt (1),
.IR grdmath (1),
.IR grdtrack (1)
.IR mlconverter (1)
